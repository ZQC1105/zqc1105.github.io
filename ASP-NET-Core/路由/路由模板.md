下面把这段代码里每个路由模板、匹配规则以及常见疑问一次讲透，可直接当成“官方文档 + 实验报告”来看。

---

1. 控制器级模板

```csharp
[Route("api/[controller]")]
```

- `[controller]` 是令牌替换，运行时会被当前控制器名字去掉后缀的部分替换。

  `Test2Controller` → `test2`（注意：自动小写）。

  因此整个控制器下所有动作的公共前缀都是 `/api/test2`。

---

2. 四个动作逐一拆解

方法属性路由模板最终匹配地址能否命中备注
`ListProducts``[HttpGet]``GET /api/test2`✅空模板 = 只留控制器前缀
`GetProduct``[HttpGet("{id}")]``GET /api/test2/xyz`✅`{id}` 是任意字符串（除 `/` 外）
`GetIntProduct``[HttpGet("int/{id:int}")]``GET /api/test2/int/3`✅`:int` 是内联约束，仅当 `id` 是 `int` 类型才命中
`GetInt2Product``[HttpGet("int2/{id}")]``GET /api/test2/int2/3`✅模板里没有约束，但方法签名是 `int id`，模型绑定会尝试把 `"3"` 转成 `int`；失败时返回 400

---

3. 常见疑问 & 坑

3.1 为什么 `int2/{id}` 也能收到数字？
- 模板本身没约束，模型绑定阶段才把字符串 `"3"` 转成 `int`。  
- 如果用户传 `/api/test2/int2/abc`，路由能匹配，但绑定失败 → 400 BadRequest（JSON 里会有 `The value 'abc' is not valid for id.`）。

3.2 把 `int2/{id}` 改成 `int2/{id:int}` 会怎样？
- 路由阶段就拒掉非整数，直接 404，不会进动作方法。

3.3 大小写敏感吗？
- 路由模板不区分大小写，`/api/Test2/Int/3` 同样能命中。

3.4 令牌替换还有哪些？
- `[action]` → 方法名（小写），可用于 `[Route("[action]")]`。  
- `[area]` → Area 名，三者只能用在模板字符串里。

---

4. 快速验证脚本（dotnet 8 单文件版）
把下面代码粘到 `Program.cs`，`dotnet run` 后依次敲地址即可看到路由信息：

```csharp
var builder = WebApplication.CreateBuilder();
builder.Services.AddControllers();
var app = builder.Build();
app.MapControllers();
app.Run();

// 需要把 MyDisplayRouteInfo 扩展方法拷到项目里，或者自己 return Ok(new { template = HttpContext.GetRouteData().Values });
```

---

5. 官方入口（复制到浏览器即可）
- 令牌替换与顺序：https://learn.microsoft.com/en-us/aspnet/core/mvc/controllers/routing#token-replacement  
- 内联约束完整列表：https://learn.microsoft.com/en-us/aspnet/core/fundamentals/routing#route-constraints  
- 模型绑定 vs 路由约束区别：https://learn.microsoft.com/en-us/aspnet/core/mvc/models/model-binding

---

一句话总结

`[Route("api/[controller]")]` 只是给整个控制器“定前缀”，真正的匹配规则由 `[HttpGet(...)]` 模板 + 内联约束 + 模型绑定 三件套共同决定；想提前拒掉非法值就用 `:int` 这类路由约束，否则就靠模型绑定在方法参数里兜底转换。