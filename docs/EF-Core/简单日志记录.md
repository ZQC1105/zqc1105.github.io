## [简单日志记录](https://learn.microsoft.com/zh-cn/ef/core/logging-events-diagnostics/simple-logging)

`LogTo` 是 EF Core 5.0+ 提供的 **“一行代码就能看 SQL”** 的轻量级日志方案，官方叫 **Simple Logging**。  
无需引入任何第三方包（NLog、Serilog 都不用），也无需配置 `ILoggerFactory`，最适合在控制台程序、示例项目里快速调试。

---

### 1. 最小可用写法

```csharp
protected override void OnConfiguring(DbContextOptionsBuilder b)
{
    b.UseSqlServer(_connStr)
     .LogTo(Console.WriteLine);   // 默认级别 Information
}
```

运行后每条 SQL 都会原样输出：

```
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (2ms) [Parameters=[...], CommandType='Text', CommandTimeout='30']
      SELECT [b].[BlogId], [b].[Name] FROM [Blogs] AS [b]
```

---

### 2. 完整重载签名

```csharp
LogTo(
    Action<string> writeAction,        // 字符串写到哪里
    LogLevel minimumLevel = Information, // 最低级别
    IEnumerable<string> categories = null, // 只留空即可
    Func<EventId, LogLevel, bool> filter = null, // 额外过滤
    DbContextLoggerOptions options = None)       // 附加信息开关
```

---

### 3. 常用组合示例

| 场景             | 代码                                                                                          |
| ---------------- | --------------------------------------------------------------------------------------------- |
| **只看 SQL**     | `.LogTo(Console.WriteLine, LogLevel.Information)`                                             |
| **SQL + 参数值** | `.LogTo(Console.WriteLine, LogLevel.Information, options: DbContextLoggerOptions.SingleLine)` |
| **写到文件**     | `.LogTo(File.CreateText("sql.log").WriteLine, LogLevel.Information)`                          |
| **调试窗口**     | `.LogTo(Debug.WriteLine, LogLevel.Information)`                                               |

---

### 4. 日志级别对照表

| 级别          | 会看到什么                        |
| ------------- | --------------------------------- |
| `Trace`       | 最细，包括 EF 内部状态变化        |
| `Debug`       | 翻译后的 LINQ 表达式树            |
| `Information` | **SQL 语句 + 执行耗时**（最常用） |
| `Warning`     | 查询缓存未命中、索引提示等        |
| `Error`       | 执行失败时的异常详情              |

---

### 5. 与 ILoggerFactory 的关系

- `LogTo` 是 **独立通道**，不会干扰 ASP.NET Core 的 `ILogger`。
- 如果已经配置了 `AddDbContext<T>(b => b.UseLoggerFactory(...))`，`LogTo` 仍可并存，两边都会写。

---

### 6. 关闭/动态开关

Simple Logging 没有开关 API，需要动态控制时：

```csharp
#if DEBUG
    builder.LogTo(Console.WriteLine, LogLevel.Information);
#endif
```

或把 `Action<string>` 指向空方法即可变相“关闭”。

---

### 7. 一句话总结

`LogTo(Console.WriteLine, LogLevel.Information)` = **零依赖、零配置、一眼看到 SQL** 的 EF Core 官方“简易控制台记录器”。
